{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "multyagents/contracts/v1/context7.schema.json",
  "title": "Context7 Contracts v1",
  "type": "object",
  "$defs": {
    "Context7Mode": {
      "type": "string",
      "enum": ["inherit", "force_on", "force_off"]
    },
    "ExecutionMode": {
      "type": "string",
      "enum": ["no-workspace", "shared-workspace", "isolated-worktree", "docker-sandbox"]
    },
    "ApprovalStatus": {
      "type": "string",
      "enum": ["pending", "approved", "rejected"]
    },
    "WorkflowRunStatus": {
      "type": "string",
      "enum": ["created", "running", "paused", "aborted", "success", "failed"]
    },
    "TaskStatus": {
      "type": "string",
      "enum": ["created", "dispatched", "queued", "running", "cancel-requested", "success", "failed", "canceled", "submit-failed"]
    },
    "QualityGateSeverity": {
      "type": "string",
      "enum": ["blocker", "warn"]
    },
    "QualityGateCheckStatus": {
      "type": "string",
      "enum": ["pass", "fail", "pending", "skipped"]
    },
    "QualityGateSummaryStatus": {
      "type": "string",
      "enum": ["pass", "fail", "pending", "not-configured"]
    },
    "QualityGateCheckPolicy": {
      "type": "object",
      "required": ["check", "required", "severity", "config", "description"],
      "properties": {
        "check": { "type": "string", "minLength": 1 },
        "required": { "type": "boolean" },
        "severity": { "$ref": "#/$defs/QualityGateSeverity" },
        "config": { "type": "object" },
        "description": { "type": ["string", "null"] }
      },
      "additionalProperties": false
    },
    "QualityGatePolicy": {
      "type": "object",
      "required": ["required_checks"],
      "properties": {
        "required_checks": {
          "type": "array",
          "items": { "$ref": "#/$defs/QualityGateCheckPolicy" }
        }
      },
      "additionalProperties": false
    },
    "QualityGateCheckResult": {
      "type": "object",
      "required": ["check", "status", "severity", "required", "blocker", "message", "details"],
      "properties": {
        "check": { "type": "string", "minLength": 1 },
        "status": { "$ref": "#/$defs/QualityGateCheckStatus" },
        "severity": { "$ref": "#/$defs/QualityGateSeverity" },
        "required": { "type": "boolean" },
        "blocker": { "type": "boolean" },
        "message": { "type": "string", "minLength": 1 },
        "details": { "type": "object" }
      },
      "additionalProperties": false
    },
    "QualityGateSummary": {
      "type": "object",
      "required": [
        "status",
        "summary_text",
        "total_checks",
        "passed_checks",
        "failed_checks",
        "pending_checks",
        "skipped_checks",
        "blocker_failures",
        "warning_failures",
        "checks"
      ],
      "properties": {
        "status": { "$ref": "#/$defs/QualityGateSummaryStatus" },
        "summary_text": { "type": "string" },
        "total_checks": { "type": "integer", "minimum": 0 },
        "passed_checks": { "type": "integer", "minimum": 0 },
        "failed_checks": { "type": "integer", "minimum": 0 },
        "pending_checks": { "type": "integer", "minimum": 0 },
        "skipped_checks": { "type": "integer", "minimum": 0 },
        "blocker_failures": { "type": "integer", "minimum": 0 },
        "warning_failures": { "type": "integer", "minimum": 0 },
        "checks": {
          "type": "array",
          "items": { "$ref": "#/$defs/QualityGateCheckResult" }
        }
      },
      "additionalProperties": false
    },
    "QualityGateRunSummary": {
      "type": "object",
      "required": [
        "status",
        "summary_text",
        "total_tasks",
        "passing_tasks",
        "failing_tasks",
        "pending_tasks",
        "not_configured_tasks",
        "total_checks",
        "passed_checks",
        "failed_checks",
        "pending_checks",
        "skipped_checks",
        "blocker_failures",
        "warning_failures"
      ],
      "properties": {
        "status": { "$ref": "#/$defs/QualityGateSummaryStatus" },
        "summary_text": { "type": "string" },
        "total_tasks": { "type": "integer", "minimum": 0 },
        "passing_tasks": { "type": "integer", "minimum": 0 },
        "failing_tasks": { "type": "integer", "minimum": 0 },
        "pending_tasks": { "type": "integer", "minimum": 0 },
        "not_configured_tasks": { "type": "integer", "minimum": 0 },
        "total_checks": { "type": "integer", "minimum": 0 },
        "passed_checks": { "type": "integer", "minimum": 0 },
        "failed_checks": { "type": "integer", "minimum": 0 },
        "pending_checks": { "type": "integer", "minimum": 0 },
        "skipped_checks": { "type": "integer", "minimum": 0 },
        "blocker_failures": { "type": "integer", "minimum": 0 },
        "warning_failures": { "type": "integer", "minimum": 0 }
      },
      "additionalProperties": false
    },
    "RoleRead": {
      "type": "object",
      "required": [
        "id",
        "name",
        "context7_enabled",
        "system_prompt",
        "allowed_tools",
        "skill_packs",
        "execution_constraints"
      ],
      "properties": {
        "id": { "type": "integer", "minimum": 1 },
        "name": { "type": "string", "minLength": 1 },
        "context7_enabled": { "type": "boolean" },
        "system_prompt": { "type": "string" },
        "allowed_tools": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "skill_packs": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "execution_constraints": { "type": "object" }
      },
      "additionalProperties": false
    },
    "TaskRead": {
      "type": "object",
      "required": [
        "id",
        "role_id",
        "title",
        "context7_mode",
        "execution_mode",
        "status",
        "requires_approval",
        "project_id",
        "lock_paths",
        "runner_message",
        "started_at",
        "finished_at",
        "exit_code",
        "failure_category",
        "failure_triage_hints",
        "suggested_next_actions"
      ],
      "properties": {
        "id": { "type": "integer", "minimum": 1 },
        "role_id": { "type": "integer", "minimum": 1 },
        "title": { "type": "string", "minLength": 1 },
        "context7_mode": { "$ref": "#/$defs/Context7Mode" },
        "execution_mode": { "$ref": "#/$defs/ExecutionMode" },
        "status": { "$ref": "#/$defs/TaskStatus" },
        "requires_approval": { "type": "boolean" },
        "project_id": { "type": ["integer", "null"], "minimum": 1 },
        "lock_paths": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "runner_message": { "type": ["string", "null"] },
        "started_at": { "type": ["string", "null"] },
        "finished_at": { "type": ["string", "null"] },
        "exit_code": { "type": ["integer", "null"] },
        "failure_category": { "type": ["string", "null"] },
        "failure_triage_hints": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "suggested_next_actions": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "quality_gate_policy": {
          "anyOf": [
            { "$ref": "#/$defs/QualityGatePolicy" },
            { "type": "null" }
          ]
        },
        "quality_gate_summary": {
          "anyOf": [
            { "$ref": "#/$defs/QualityGateSummary" },
            { "type": "null" }
          ]
        }
      },
      "additionalProperties": false
    },
    "TaskHandoffArtifactRef": {
      "type": "object",
      "required": ["artifact_id", "is_required", "note"],
      "properties": {
        "artifact_id": { "type": "integer", "minimum": 1 },
        "is_required": { "type": "boolean" },
        "note": { "type": ["string", "null"] }
      },
      "additionalProperties": false
    },
    "TaskHandoffRead": {
      "type": "object",
      "required": [
        "task_id",
        "run_id",
        "summary",
        "details",
        "next_actions",
        "open_questions",
        "artifacts",
        "created_at",
        "updated_at"
      ],
      "properties": {
        "task_id": { "type": "integer", "minimum": 1 },
        "run_id": { "type": ["integer", "null"], "minimum": 1 },
        "summary": { "type": "string", "minLength": 1 },
        "details": { "type": ["string", "null"] },
        "next_actions": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "open_questions": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "artifacts": {
          "type": "array",
          "items": { "$ref": "#/$defs/TaskHandoffArtifactRef" }
        },
        "created_at": { "type": "string", "minLength": 1 },
        "updated_at": { "type": "string", "minLength": 1 }
      },
      "additionalProperties": false
    },
    "TaskAudit": {
      "type": "object",
      "required": [
        "task_id",
        "role_id",
        "context7_mode",
        "role_context7_enabled",
        "resolved_context7_enabled",
        "execution_mode",
        "requires_approval",
        "approval_status",
        "project_id",
        "lock_paths",
        "handoff"
      ],
      "properties": {
        "task_id": { "type": "integer", "minimum": 1 },
        "role_id": { "type": "integer", "minimum": 1 },
        "context7_mode": { "$ref": "#/$defs/Context7Mode" },
        "role_context7_enabled": { "type": "boolean" },
        "resolved_context7_enabled": { "type": "boolean" },
        "execution_mode": { "$ref": "#/$defs/ExecutionMode" },
        "requires_approval": { "type": "boolean" },
        "approval_status": {
          "anyOf": [
            { "$ref": "#/$defs/ApprovalStatus" },
            { "type": "null" }
          ]
        },
        "project_id": { "type": ["integer", "null"], "minimum": 1 },
        "lock_paths": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "handoff": {
          "anyOf": [{ "$ref": "#/$defs/TaskHandoffRead" }, { "type": "null" }]
        },
        "retry_attempts": { "type": "integer", "minimum": 0 },
        "last_retry_reason": { "type": ["string", "null"] },
        "failure_categories": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "failure_triage_hints": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "rerun_count": { "type": "integer", "minimum": 0 },
        "last_rerun_by": { "type": ["string", "null"] },
        "last_rerun_reason": { "type": ["string", "null"] },
        "last_rerun_at": { "type": ["string", "null"] }
      },
      "additionalProperties": false
    },
    "SharedWorkspaceContext": {
      "type": "object",
      "required": ["project_id", "project_root", "lock_paths"],
      "properties": {
        "project_id": { "type": "integer", "minimum": 1 },
        "project_root": { "type": "string", "minLength": 1 },
        "lock_paths": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "worktree_path": { "type": ["string", "null"] },
        "git_branch": { "type": ["string", "null"] }
      },
      "additionalProperties": false
    },
    "DispatchResponse": {
      "type": "object",
      "required": ["task_id", "resolved_context7_enabled", "runner_payload"],
      "properties": {
        "task_id": { "type": "integer", "minimum": 1 },
        "resolved_context7_enabled": { "type": "boolean" },
        "runner_payload": {
          "type": "object",
          "required": ["task_id", "role_id", "title", "execution_mode", "context", "workspace"],
          "properties": {
            "task_id": { "type": "integer", "minimum": 1 },
            "role_id": { "type": "integer", "minimum": 1 },
            "title": { "type": "string" },
            "execution_mode": { "$ref": "#/$defs/ExecutionMode" },
            "context": {
              "type": "object",
              "required": ["provider", "enabled"],
              "properties": {
                "provider": { "type": "string", "const": "context7" },
                "enabled": { "type": "boolean" }
              },
              "additionalProperties": false
            },
            "workspace": {
              "anyOf": [
                { "$ref": "#/$defs/SharedWorkspaceContext" },
                { "type": "null" }
              ]
            },
            "handoff_context": {
              "type": "array",
              "items": { "$ref": "#/$defs/TaskHandoffRead" }
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "WorkflowRunRoleMetric": {
      "type": "object",
      "required": [
        "role_id",
        "task_count",
        "successful_tasks",
        "failed_tasks",
        "throughput_tasks",
        "success_rate",
        "retries_total",
        "duration_ms"
      ],
      "properties": {
        "role_id": { "type": "integer", "minimum": 1 },
        "task_count": { "type": "integer", "minimum": 0 },
        "successful_tasks": { "type": "integer", "minimum": 0 },
        "failed_tasks": { "type": "integer", "minimum": 0 },
        "throughput_tasks": { "type": "integer", "minimum": 0 },
        "success_rate": { "type": "number", "minimum": 0, "maximum": 100 },
        "retries_total": { "type": "integer", "minimum": 0 },
        "duration_ms": { "type": ["integer", "null"], "minimum": 0 }
      },
      "additionalProperties": false
    },
    "WorkflowRunRead": {
      "type": "object",
      "required": [
        "id",
        "workflow_template_id",
        "task_ids",
        "status",
        "initiated_by",
        "created_at",
        "updated_at",
        "failure_categories",
        "failure_triage_hints",
        "suggested_next_actions",
        "duration_ms",
        "success_rate",
        "retries_total",
        "per_role"
      ],
      "properties": {
        "id": { "type": "integer", "minimum": 1 },
        "workflow_template_id": { "type": ["integer", "null"], "minimum": 1 },
        "task_ids": {
          "type": "array",
          "items": { "type": "integer", "minimum": 1 }
        },
        "status": { "$ref": "#/$defs/WorkflowRunStatus" },
        "initiated_by": { "type": ["string", "null"] },
        "created_at": { "type": "string", "minLength": 1 },
        "updated_at": { "type": "string", "minLength": 1 },
        "retry_summary": { "type": "object" },
        "failure_categories": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "failure_triage_hints": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "suggested_next_actions": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "duration_ms": { "type": ["integer", "null"], "minimum": 0 },
        "success_rate": { "type": "number", "minimum": 0, "maximum": 100 },
        "retries_total": { "type": "integer", "minimum": 0 },
        "per_role": {
          "type": "array",
          "items": { "$ref": "#/$defs/WorkflowRunRoleMetric" }
        },
        "quality_gate_summary": {
          "anyOf": [
            { "$ref": "#/$defs/QualityGateRunSummary" },
            { "type": "null" }
          ]
        }
      },
      "additionalProperties": false
    },
    "WorkflowRunDispatchReadyResponse": {
      "type": "object",
      "required": ["run_id", "dispatched", "task_id", "reason", "dispatch"],
      "properties": {
        "run_id": { "type": "integer", "minimum": 1 },
        "dispatched": { "type": "boolean" },
        "task_id": { "type": ["integer", "null"], "minimum": 1 },
        "reason": { "type": ["string", "null"] },
        "dispatch": { "type": ["object", "null"] }
      },
      "additionalProperties": false
    },
    "EventRead": {
      "type": "object",
      "required": ["id", "event_type", "run_id", "task_id", "payload", "created_at"],
      "properties": {
        "id": { "type": "integer", "minimum": 1 },
        "event_type": { "type": "string", "minLength": 1 },
        "run_id": { "type": ["integer", "null"], "minimum": 1 },
        "task_id": { "type": ["integer", "null"], "minimum": 1 },
        "payload": { "type": "object" },
        "created_at": { "type": "string", "minLength": 1 }
      },
      "additionalProperties": true
    }
  }
}
